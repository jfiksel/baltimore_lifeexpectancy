---
title: "Baltimore Life Expectancy"
author: "Jacob Fiksel"
date: "September 12, 2016"
output: html_document
---
The purpose of this project is to predict life expectancy in Baltimore on a single block resolution. The main source of data for life expectancy at the neighborhood level are the [Baltimore City Health Department Neighborhood Health Profiles](http://health.baltimorecity.gov/node/231). I plan on utilizing free data provided by [OpenBaltimore](https://data.baltimorecity.gov), which appears to have a more cleaned up version of the above data set in the [Children and Family Health & Well-Being (2010-2014)](https://data.baltimorecity.gov/Neighborhoods/Children-and-Family-Health-Well-Being-2010-2014-/rtbq-mnni) and [Housing and Community Development (2010-2014)](https://data.baltimorecity.gov/Neighborhoods/Housing-and-Community-Development-2010-2014-/mvvs-32jm) reports. Some potentially useful datasets are:

* [Building vacancies in Baltimore](https://data.baltimorecity.gov/Housing-Development/Vacant-Buildings/qqcv-ihn5) which provides the street and neighborhood of all current building vacancies. This is updated at least twice a month
* [Victim based crime](https://data.baltimorecity.gov/Public-Safety/BPD-Part-1-Victim-Based-Crime-Data/wsfq-mvij). Accessing this on Sept. 13, 2016 the most recent crime listed occurred on Sept. 3, 2016
* [Real property taxes](https://data.baltimorecity.gov/Financial/Real-Property-Taxes/27w9-urtv) at an address level
* [Liquor licenses](https://data.baltimorecity.gov/City-Services/Liquor-Licenses/xv8d-bwgi)
* [2010 Census data](https://data.baltimorecity.gov/Neighborhoods/Census-Demographics-2010/cix3-h4cy) at a neighborhood level
* [Grocery stores](https://data.baltimorecity.gov/Health/Grocery-Stores/uuwk-975y). Contains type of supermarket and location. Could be interesting to look at distance to closest grocery store, and clusters of small or limited groceries stores predict health outcomes

```{r load_packages, results='hide'}
install.packages(c("XML", "downloader","pdftools"), repos="http://cran.rstudio.com/")
library(pdftools)
library(XML)
library(downloader)
```

```{r download_pdfs, results='hide'}
reports <- 'http://health.baltimorecity.gov/neighborhood-health-profile-reports'
reports.html <- htmlParse(reports)
find.pdf <- xpathSApply(reports.html, "//a/@href")
pdf.url <- as.character(find.pdf[grep('pdf', find.pdf)])
pdf.urlrecent <- pdf.url[!grepl('2008', pdf.url)]
pdf.names <- sapply(pdf.urlrecent, function(url){
  start <- regexpr("%20", url) + 3 
  stop <- nchar(url)-4
  name <- substr(url, start, stop)
  gsub("%20", "_", name)
},USE.NAMES=FALSE)

if(!file.exists("data")){
  dir.create("data")
}
if(!file.exists("data/rawpdfs")){
  dir.create("data/rawpdfs")
}
lapply(seq_along(pdf.urlrecent), function(ind){
  file.name <- paste0("./data/rawpdfs/", pdf.names[ind],".pdf")
  if(!file.exists(file.name)){
    download(pdf.urlrecent[ind], file.name)
  }
  dateDownloaded <- date()
  saveRDS(dateDownloaded, "./data/rawpdfs/dateDownloaded.rds")
  })
```

```{r process_pdfs}
pdf_list <- list.files(path="./data/rawpdfs",pattern="pdf$", full.names=TRUE)
pdf <- pdf_list[1]
text <- pdf_text(pdf)
```
